<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.warmheart.workerunion.server.dao.MaterialHeadquartersOrderDetailMapper">
	<resultMap id="BaseResultMap" type="top.warmheart.workerunion.server.model.MaterialHeadquartersOrderDetail">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="company_id" jdbcType="BIGINT" property="companyId" />
		<result column="material_headquarters_order_id" jdbcType="BIGINT" property="materialHeadquartersOrderId" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="num" jdbcType="VARCHAR" property="num" />
		<result column="model" jdbcType="VARCHAR" property="model" />
		<result column="unit" jdbcType="VARCHAR" property="unit" />
		<result column="amount" jdbcType="DECIMAL" property="amount" />
		<result column="price" jdbcType="DECIMAL" property="price" />
		<result column="money" jdbcType="DECIMAL" property="money" />
		<result column="cst_create" jdbcType="TIMESTAMP" property="cstCreate" />
		<result column="cst_modified" jdbcType="TIMESTAMP" property="cstModified" />
		<result column="is_del" jdbcType="BIT" property="del" />
	</resultMap>
	<resultMap id="MaterialHeadquartersOrderDetail2DtoMap" type="top.warmheart.workerunion.server.dto.MaterialHeadquartersOrderDetail2Dto">
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="company_id" jdbcType="BIGINT" property="companyId" />
		<result column="material_headquarters_order_id" jdbcType="BIGINT" property="materialHeadquartersOrderId" />
		<result column="material_headquarters_order_batch_no" jdbcType="VARCHAR" property="materialHeadquartersOrderBatchNo" />
		<result column="material_headquarters_order_type" jdbcType="VARCHAR" property="materialHeadquartersOrderType" />
		<result column="material_headquarters_order_staff_id" jdbcType="BIGINT" property="materialHeadquartersOrderStaffId" />
		<result column="material_headquarters_order_staff_name" jdbcType="VARCHAR" property="materialHeadquartersOrderStaffName" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="num" jdbcType="VARCHAR" property="num" />
		<result column="model" jdbcType="VARCHAR" property="model" />
		<result column="unit" jdbcType="VARCHAR" property="unit" />
		<result column="amount" jdbcType="DECIMAL" property="amount" />
		<result column="price" jdbcType="DECIMAL" property="price" />
		<result column="money" jdbcType="DECIMAL" property="money" />
		<result column="cst_create" jdbcType="TIMESTAMP" property="cstCreate" />
		<result column="cst_modified" jdbcType="TIMESTAMP" property="cstModified" />
		<result column="is_del" jdbcType="BIT" property="del" />
	</resultMap>
	<delete id="deleteByPrimaryKey" parameterType="java.math.BigInteger">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		delete from material_headquarters_order_detail
		where id = #{id,jdbcType=BIGINT}
	</delete>
	<insert id="insert" parameterType="top.warmheart.workerunion.server.model.MaterialHeadquartersOrderDetail">
		<selectKey keyProperty="id" order="AFTER" resultType="java.math.BigInteger">
			SELECT LAST_INSERT_ID()
		</selectKey>
		insert into material_headquarters_order_detail (company_id, material_headquarters_order_id,
		name, num, model, unit,
		amount, price, money,
		cst_create, cst_modified, is_del
		)
		values (#{companyId,jdbcType=BIGINT},
		#{materialHeadquartersOrderId,jdbcType=BIGINT},
		#{name,jdbcType=VARCHAR}, #{num,jdbcType=VARCHAR},
		#{model,jdbcType=VARCHAR}, #{unit,jdbcType=VARCHAR},
		#{amount,jdbcType=DECIMAL}, #{price,jdbcType=DECIMAL},
		#{money,jdbcType=DECIMAL},
		now(),
		now(), false
		)
	</insert>
	<update id="updateByPrimaryKey" parameterType="top.warmheart.workerunion.server.model.MaterialHeadquartersOrderDetail">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		update material_headquarters_order_detail
		set company_id = #{companyId,jdbcType=BIGINT},
		material_headquarters_order_id
		= #{materialHeadquartersOrderId,jdbcType=BIGINT},
		name = #{name,jdbcType=VARCHAR},
		num = #{num,jdbcType=VARCHAR},
		model =
		#{model,jdbcType=VARCHAR},
		unit = #{unit,jdbcType=VARCHAR},
		amount = #{amount,jdbcType=DECIMAL},
		price =
		#{price,jdbcType=DECIMAL},
		money = #{money,jdbcType=DECIMAL},
		cst_create = #{cstCreate,jdbcType=TIMESTAMP},
		cst_modified
		= #{cstModified,jdbcType=TIMESTAMP},
		is_del = #{del,jdbcType=BIT}
		where id = #{id,jdbcType=BIGINT}
	</update>
	<select id="selectByPrimaryKey" parameterType="java.math.BigInteger" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select id, company_id, material_headquarters_order_id, name, num, model, unit, amount,
		price, money, cst_create,
		cst_modified, is_del
		from material_headquarters_order_detail
		where id = #{id,jdbcType=BIGINT}
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select id, company_id, material_headquarters_order_id, name, num, model, unit, amount,
		price, money, cst_create,
		cst_modified, is_del
		from material_headquarters_order_detail
	</select>
	<select id="amountByType" resultType="java.math.BigDecimal">
		select ifnull(sum(modd.amount),0)
		from material_headquarters_order_detail
		modd,material_headquarters_order mo where modd.material_headquarters_order_id=mo.id and
		modd.company_id=#{companyId,jdbcType=BIGINT} and
		modd.num=#{num,jdbcType=VARCHAR} and mo.type=#{type,
		jdbcType=VARCHAR}
		and modd.is_del=false and mo.is_del=false
	</select>

	<select id="countByNum" resultType="java.lang.Integer">
		select count(distinct id) from material_headquarters_order_detail where
		company_id=#{companyId,jdbcType=BIGINT} and num=#{num, jdbcType=VARCHAR} and is_del=false
	</select>

	<select id="pageByNum" resultMap="MaterialHeadquartersOrderDetail2DtoMap">
		select modd.id, modd.company_id, 
		modd.material_headquarters_order_id,
		modd.name, modd.num, modd.model, modd.unit,
		modd.amount,
		modd.price, modd.money,
		modd.cst_create, modd.cst_modified,
		modd.is_del, mo.batch_no as material_headquarters_order_batch_no,
		mo.type as
		material_headquarters_order_type,mo.staff_id as material_headquarters_order_staff_id,mo.staff_name as
		material_headquarters_order_staff_name
		from material_headquarters_order_detail modd, (select distinct
		id,material_headquarters_order_id
		from
		material_headquarters_order_detail where
		company_id=#{companyId,jdbcType=BIGINT}
		and
		num=#{num, jdbcType=VARCHAR} and is_del=false
		order
		by id
		desc limit
		#{page.frontIndex},#{page.size})temp,material_headquarters_order mo where
		modd.id=temp.id and
		mo.id=temp.material_headquarters_order_id order by id desc
	</select>

	<select id="countByFuzzy" resultType="java.lang.Integer">
		select count(distinct modd.id)
		from material_headquarters_order_detail modd,material_headquarters_order mo where
		modd.material_headquarters_order_id=mo.id and
		modd.company_id=#{companyId,jdbcType=BIGINT} and modd.is_del=false and
		mo.is_del=false
		<if test="staffName != null and staffName != ''">
			and mo.staff_name like CONCAT('%',#{staffName,jdbcType=VARCHAR},'%')
		</if>
		<if test="cstCreate != null">
			and to_days(mo.cst_create)=to_days(#{cstCreate,jdbcType=TIMESTAMP})
		</if>
		<if test="batchNo != null and batchNo != ''">
			and mo.batch_no like CONCAT('%',#{batchNo,jdbcType=VARCHAR},'%')
		</if>
	</select>
	<select id="pageByFuzzy" resultMap="MaterialHeadquartersOrderDetail2DtoMap">
		select modd.id, modd.company_id, modd.material_headquarters_order_id, modd.name, modd.num,
		modd.model, modd.unit,
		modd.amount,
		modd.price, modd.money, modd.cst_create, modd.cst_modified, modd.is_del, mo.batch_no
		as
		material_headquarters_order_batch_no,
		mo.type as material_headquarters_order_type,mo.staff_id as
		material_headquarters_order_staff_id,mo.staff_name as
		material_headquarters_order_staff_name
		from
		material_headquarters_order_detail modd,material_headquarters_order mo,(select distinct modd2.id
		from
		material_headquarters_order_detail
		modd2,material_headquarters_order mo2 where
		modd2.material_headquarters_order_id=mo2.id and modd2.company_id=#{companyId,jdbcType=BIGINT} and
		modd2.is_del=false
		and mo2.is_del=false
		<if test="staffName != null and staffName != ''">
			and mo2.staff_name like CONCAT('%',#{staffName,jdbcType=VARCHAR},'%')
		</if>
		<if test="cstCreate != null">
			and to_days(mo2.cst_create)=to_days(#{cstCreate,jdbcType=TIMESTAMP})
		</if>
		<if test="batchNo != null and batchNo != ''">
			and mo2.batch_no like CONCAT('%',#{batchNo,jdbcType=VARCHAR},'%')
		</if>
		order by mo2.batch_no asc, modd2.id asc limit #{page.frontIndex},#{page.size})temp
		where modd.id=temp.id and
		modd.material_headquarters_order_id=mo.id and mo.is_del=false and modd.is_del = false order by mo.batch_no asc,
		modd.id asc
	</select>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.warmheart.workerunion.server.dao.ResourceImplementItemMapper">
	<resultMap id="BaseResultMap" type="top.warmheart.workerunion.server.model.ResourceImplementItem">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="company_id" jdbcType="BIGINT" property="companyId" />
		<result column="project_id" jdbcType="BIGINT" property="projectId" />
		<result column="fund_plan_item_id" jdbcType="BIGINT" property="fundPlanItemId" />
		<result column="subcontractor_id" jdbcType="BIGINT" property="subcontractorId" />
		<result column="subcontractor_name" jdbcType="VARCHAR" property="subcontractorName" />
		<result column="purchase_item_id" jdbcType="BIGINT" property="purchaseItemId" />
		<result column="purchase_item_name" jdbcType="VARCHAR" property="purchaseItemName" />
		<result column="contract_id" jdbcType="BIGINT" property="contractId" />
		<result column="contract_name" jdbcType="VARCHAR" property="contractName" />
		<result column="contract_num" jdbcType="VARCHAR" property="contractNum" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="unit" jdbcType="VARCHAR" property="unit" />
		<result column="price" jdbcType="DECIMAL" property="price" />
		<result column="amount" jdbcType="DECIMAL" property="amount" />
		<result column="money" jdbcType="DECIMAL" property="money" />
		<result column="cst_create" jdbcType="TIMESTAMP" property="cstCreate" />
		<result column="cst_modified" jdbcType="TIMESTAMP" property="cstModified" />
	</resultMap>
	<resultMap id="ResourceImplementItemDtoMap" type="top.warmheart.workerunion.server.dto.ResourceImplementItemDto">
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="company_id" jdbcType="BIGINT" property="companyId" />
		<result column="project_id" jdbcType="BIGINT" property="projectId" />
		<result column="fund_plan_item_id" jdbcType="BIGINT" property="fundPlanItemId" />
		<result column="has_fund_plan_item" jdbcType="BIT" property="hasFundPlanItem" />
		<result column="subcontractor_id" jdbcType="BIGINT" property="subcontractorId" />
		<result column="subcontractor_name" jdbcType="VARCHAR" property="subcontractorName" />
		<result column="purchase_item_id" jdbcType="BIGINT" property="purchaseItemId" />
		<result column="purchase_item_name" jdbcType="VARCHAR" property="purchaseItemName" />
		<result column="contract_id" jdbcType="BIGINT" property="contractId" />
		<result column="contract_name" jdbcType="VARCHAR" property="contractName" />
		<result column="contract_num" jdbcType="VARCHAR" property="contractNum" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="unit" jdbcType="VARCHAR" property="unit" />
		<result column="price" jdbcType="DECIMAL" property="price" />
		<result column="amount" jdbcType="DECIMAL" property="amount" />
		<result column="money" jdbcType="DECIMAL" property="money" />
		<result column="money_plan" jdbcType="DECIMAL" property="moneyPlan" />
		<result column="money_retain" jdbcType="DECIMAL" property="moneyRetain" />
		<result column="cst_create" jdbcType="TIMESTAMP" property="cstCreate" />
		<result column="cst_modified" jdbcType="TIMESTAMP" property="cstModified" />
	</resultMap>
	<delete id="deleteByPrimaryKey" parameterType="java.math.BigInteger">
		delete from resource_implement_item
		where id = #{id,jdbcType=BIGINT} and not exists (select * from settlement_item si where
		si.resource_implement_item_id=#{id,jdbcType=BIGINT})
	</delete>
	<insert id="insert" parameterType="top.warmheart.workerunion.server.model.ResourceImplementItem">
		<selectKey keyProperty="id" order="AFTER" resultType="java.math.BigInteger">
			SELECT LAST_INSERT_ID()
		</selectKey>
		insert into resource_implement_item (company_id, project_id, fund_plan_item_id,
		subcontractor_id, subcontractor_name, contract_id,
		contract_name, contract_num, name,
		unit, price, amount,
		money, cst_create, cst_modified,purchase_item_id,purchase_item_name
		)
		values (#{companyId,jdbcType=BIGINT}, #{projectId,jdbcType=BIGINT}, #{fundPlanItemId,jdbcType=BIGINT},
		#{subcontractorId,jdbcType=BIGINT}, #{subcontractorName,jdbcType=VARCHAR}, #{contractId,jdbcType=BIGINT},
		#{contractName,jdbcType=VARCHAR}, #{contractNum,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR},
		#{unit,jdbcType=VARCHAR}, #{price,jdbcType=DECIMAL}, #{amount,jdbcType=DECIMAL},
		#{money,jdbcType=DECIMAL}, now(), now(), #{purchaseItemId,jdbcType=BIGINT},
		#{purchaseItemName,jdbcType=VARCHAR}
		)
	</insert>
	<update id="updateByPrimaryKey" parameterType="top.warmheart.workerunion.server.model.ResourceImplementItem">
		update resource_implement_item
		set company_id = #{companyId,jdbcType=BIGINT},
		project_id = #{projectId,jdbcType=BIGINT},
		fund_plan_item_id = #{fundPlanItemId,jdbcType=BIGINT},
		subcontractor_id = #{subcontractorId,jdbcType=BIGINT},
		subcontractor_name = #{subcontractorName,jdbcType=VARCHAR},
		purchase_item_id = #{purchaseItemId,jdbcType=BIGINT},
		purchase_item_name = #{purchaseItemName,jdbcType=VARCHAR},
		contract_id = #{contractId,jdbcType=BIGINT},
		contract_name = #{contractName,jdbcType=VARCHAR},
		contract_num = #{contractNum,jdbcType=VARCHAR},
		name = #{name,jdbcType=VARCHAR},
		unit = #{unit,jdbcType=VARCHAR},
		price = #{price,jdbcType=DECIMAL},
		amount = #{amount,jdbcType=DECIMAL},
		money = #{money,jdbcType=DECIMAL},
		cst_modified = now()
		where id = #{id,jdbcType=BIGINT}
	</update>
	<select id="selectByPrimaryKey" parameterType="java.math.BigInteger" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select id, company_id, project_id, fund_plan_item_id, subcontractor_id, subcontractor_name,
		contract_id, contract_name, contract_num, name, unit, price, amount, money, cst_create,
		cst_modified, purchase_item_id, purchase_item_name
		from resource_implement_item
		where id = #{id,jdbcType=BIGINT}
	</select>
	<select id="selectByPrimaryKey4Update" parameterType="java.math.BigInteger" resultMap="BaseResultMap">
		select id, company_id, project_id, fund_plan_item_id, subcontractor_id, subcontractor_name,
		contract_id, contract_name, contract_num, name, unit, price, amount, money, cst_create,
		cst_modified, purchase_item_id, purchase_item_name
		from resource_implement_item
		where id = #{id,jdbcType=BIGINT} for update
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select id, company_id, project_id, fund_plan_item_id, subcontractor_id, subcontractor_name,
		contract_id, contract_name, contract_num, name, unit, price, amount, money, cst_create,
		cst_modified, purchase_item_id, purchase_item_name
		from resource_implement_item
	</select>
	<select id="selectListByProjectId" resultMap="ResourceImplementItemDtoMap">
		select rii.id, rii.company_id, rii.project_id, rii.fund_plan_item_id, rii.subcontractor_id, rii.subcontractor_name,
		rii.contract_id, rii.contract_name, rii.contract_num, rii.name, rii.unit, rii.price, rii.amount, rii.money,
		rii.cst_create, rii.purchase_item_id, rii.purchase_item_name,
		rii.cst_modified, fpi_temp.money as money_plan, !isnull(fpi_temp.id) as has_fund_plan_item, fpi_temp.money_retain
		from resource_implement_item rii left join (select fpi2.id, fpi2.money, fpi2.money-ifnull(sum(rii2.money),0) as money_retain from fund_plan_item fpi2 left join resource_implement_item rii2 on rii2.fund_plan_item_id=fpi2.id group by fpi2.id)fpi_temp on rii.fund_plan_item_id=fpi_temp.id where rii.project_id=#{projectId,jdbcType=BIGINT}
	</select>
	<select id="selectListByFundPlanItemId" resultMap="BaseResultMap">
		select id, company_id, project_id, fund_plan_item_id, subcontractor_id, subcontractor_name,
		contract_id, contract_name, contract_num, name, unit, price, amount, money, cst_create,
		cst_modified, purchase_item_id, purchase_item_name
		from resource_implement_item where fund_plan_item_id=#{fundPlanItemId,jdbcType=BIGINT}
	</select>
	<select id="selectListSimpleByProjectId" resultMap="BaseResultMap">
		select id, company_id, project_id, fund_plan_item_id, subcontractor_id, subcontractor_name,
		contract_id, contract_name, contract_num, name, unit, price, amount, money, cst_create,
		cst_modified, purchase_item_id, purchase_item_name
		from resource_implement_item where project_id=#{projectId,jdbcType=BIGINT}
	</select>
</mapper>
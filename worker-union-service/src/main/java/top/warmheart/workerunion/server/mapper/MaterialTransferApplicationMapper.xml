<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.warmheart.workerunion.server.dao.MaterialTransferApplicationMapper">
	<resultMap id="BaseResultMap" type="top.warmheart.workerunion.server.model.MaterialTransferApplication">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="company_id" jdbcType="BIGINT" property="companyId" />
		<result column="staff_id" jdbcType="BIGINT" property="staffId" />
		<result column="staff_name" jdbcType="VARCHAR" property="staffName" />
		<result column="export_project_id" jdbcType="BIGINT" property="exportProjectId" />
		<result column="import_project_id" jdbcType="BIGINT" property="importProjectId" />
		<result column="money" jdbcType="DECIMAL" property="money" />
		<result column="type" jdbcType="VARCHAR" property="type" />
		<result column="status" jdbcType="VARCHAR" property="status" />
		<result column="cst_create" jdbcType="TIMESTAMP" property="cstCreate" />
		<result column="cst_modified" jdbcType="TIMESTAMP" property="cstModified" />
		<result column="is_del" jdbcType="BIT" property="del" />
	</resultMap>
	<resultMap id="MaterialTransferApplicationDtoMap" type="top.warmheart.workerunion.server.dto.MaterialTransferApplicationDto">
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="company_id" jdbcType="BIGINT" property="companyId" />
		<result column="staff_id" jdbcType="BIGINT" property="staffId" />
		<result column="staff_name" jdbcType="VARCHAR" property="staffName" />
		<result column="export_project_id" jdbcType="BIGINT" property="exportProjectId" />
		<result column="export_project_name" jdbcType="VARCHAR" property="exportProjectName" />
		<result column="export_project_num" jdbcType="VARCHAR" property="exportProjectNum" />
		<result column="import_project_id" jdbcType="BIGINT" property="importProjectId" />
		<result column="import_project_name" jdbcType="VARCHAR" property="importProjectName" />
		<result column="import_project_num" jdbcType="VARCHAR" property="importProjectNum" />
		<result column="money" jdbcType="DECIMAL" property="money" />
		<result column="type" jdbcType="VARCHAR" property="type" />
		<result column="status" jdbcType="VARCHAR" property="status" />
		<result column="cst_create" jdbcType="TIMESTAMP" property="cstCreate" />
		<result column="cst_modified" jdbcType="TIMESTAMP" property="cstModified" />
		<result column="is_del" jdbcType="BIT" property="del" />
	</resultMap>
	<delete id="deleteByPrimaryKey" parameterType="java.math.BigInteger">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		delete from material_transfer_application
		where id = #{id,jdbcType=BIGINT}
	</delete>
	<insert id="insert" parameterType="top.warmheart.workerunion.server.model.MaterialTransferApplication">
		<selectKey keyProperty="id" order="AFTER" resultType="java.math.BigInteger">
			SELECT LAST_INSERT_ID()
		</selectKey>
		insert into material_transfer_application (company_id, staff_id, staff_name, export_project_id,
		import_project_id, money, type,
		status, cst_create, cst_modified,
		is_del)
		values (#{companyId,jdbcType=BIGINT}, #{staffId,jdbcType=BIGINT}, #{staffName,jdbcType=VARCHAR},
		#{exportProjectId,jdbcType=BIGINT},
		#{importProjectId,jdbcType=BIGINT}, #{money,jdbcType=DECIMAL}, #{type,jdbcType=VARCHAR},
		#{status,jdbcType=VARCHAR}, now(), now(),
		false)
	</insert>
	<update id="updateByPrimaryKey" parameterType="top.warmheart.workerunion.server.model.MaterialTransferApplication">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		update material_transfer_application
		set staff_id = #{staffId,jdbcType=BIGINT},
		company_id = #{companyId,jdbcType=BIGINT},
		staff_name = #{staffName,jdbcType=VARCHAR},
		export_project_id = #{exportProjectId,jdbcType=BIGINT},
		import_project_id = #{importProjectId,jdbcType=BIGINT},
		money = #{money,jdbcType=DECIMAL},
		type = #{type,jdbcType=VARCHAR},
		status = #{status,jdbcType=VARCHAR},
		cst_create = #{cstCreate,jdbcType=TIMESTAMP},
		cst_modified = #{cstModified,jdbcType=TIMESTAMP},
		is_del = #{del,jdbcType=BIT}
		where id = #{id,jdbcType=BIGINT}
	</update>
	<select id="selectByPrimaryKey" parameterType="java.math.BigInteger" resultMap="BaseResultMap">
		select id, company_id, staff_id, staff_name, export_project_id, import_project_id, money, type,
		status, cst_create, cst_modified, is_del
		from material_transfer_application
		where id = #{id,jdbcType=BIGINT}
	</select>
	<select id="selectByPrimaryKey4Update" parameterType="java.math.BigInteger" resultMap="BaseResultMap">
		select id, company_id, staff_id, staff_name, export_project_id, import_project_id, money, type,
		status, cst_create, cst_modified, is_del
		from material_transfer_application
		where id = #{id,jdbcType=BIGINT} for update
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select id,company_id, staff_id, staff_name, export_project_id, import_project_id, money, type,
		status, cst_create, cst_modified, is_del
		from material_transfer_application
	</select>

	<select id="selectDetailById" parameterType="java.math.BigInteger" resultMap="MaterialTransferApplicationDtoMap">
		select mta.id, mta.company_id, mta.staff_id, mta.staff_name, mta.export_project_id, mta.import_project_id, mta.money,
		mta.type,
		mta.status, mta.cst_create, mta.cst_modified, mta.is_del, pex.num as export_project_num, pim.num as import_project_num, pex.name
		as export_project_name, pim.name as import_project_name
		from material_transfer_application mta left join project pex on pex.id=mta.export_project_id left join project pim on
		pim.id=mta.import_project_id
		where mta.id = #{id,jdbcType=BIGINT} and mta.is_del = false
	</select>

	<select id="selectListByCompanyId" resultMap="MaterialTransferApplicationDtoMap">
		select mta.id, mta.company_id, mta.staff_id, mta.staff_name, mta.export_project_id, mta.import_project_id, mta.money,
		mta.type,
		mta.status, mta.cst_create, mta.cst_modified, mta.is_del, pex.num as export_project_num, pim.num as import_project_num, pex.name
		as export_project_name, pim.name as import_project_name
		from material_transfer_application mta left join project pex on pex.id=mta.export_project_id left join project pim on
		pim.id=mta.import_project_id
		where mta.company_id = #{companyId,jdbcType=BIGINT} and mta.status=#{status, jdbcType=VARCHAR} and mta.is_del = false
	</select>

	<!-- 获取符合模糊搜索的转库申请信息个数 -->
	<select id="countByFuzzy" resultType="java.lang.Integer">
		select count(distinct mta.id) from material_transfer_application mta left join project pex on
		pex.id=mta.export_project_id left join project pim on pim.id=mta.import_project_id
		where
		mta.company_id=#{materialTransferApplicationDto.companyId} and mta.is_del=false
		<if test="materialTransferApplicationDto.id != null">
			and mta.id like CONCAT('%',#{materialTransferApplicationDto.id},'%')
		</if>
		<if
			test="materialTransferApplicationDto.importProjectName != null and materialTransferApplicationDto.importProjectName != ''">
			and pim.name like CONCAT('%',#{materialTransferApplicationDto.importProjectName,jdbcType=VARCHAR},'%')
		</if>
		<if test="materialTransferApplicationDto.type != null and materialTransferApplicationDto.type != ''">
			and mta.type = #{materialTransferApplicationDto.type,jdbcType=VARCHAR}
		</if>
		<if
			test="materialTransferApplicationDto.exportProjectName != null and materialTransferApplicationDto.exportProjectName != ''">
			and pex.name like CONCAT('%',#{materialTransferApplicationDto.exportProjectName,jdbcType=VARCHAR},'%')
		</if>
		<if test="materialTransferApplicationDto.status != null and materialTransferApplicationDto.status != ''">
			and mta.status = #{materialTransferApplicationDto.status,jdbcType=VARCHAR}
		</if>
		<if test="materialTransferApplicationDto.staffName != null and materialTransferApplicationDto.staffName != ''">
			and mta.staff_name like CONCAT('%',#{materialTransferApplicationDto.staffName,jdbcType=VARCHAR},'%')
		</if>
		<if test="materialTransferApplicationDto.cstCreate != null">
			and to_days(mta.cst_create)=to_days(#{materialTransferApplicationDto.cstCreate,jdbcType=TIMESTAMP})
		</if>

	</select>

	<!-- 获取符合模糊搜索的转库申请信息列表 -->
	<select id="pageByFuzzy" resultMap="MaterialTransferApplicationDtoMap">
		select mta.id, mta.company_id, mta.staff_id, mta.staff_name, mta.export_project_id, mta.import_project_id, mta.money,
		mta.type,
		mta.status, mta.cst_create, mta.cst_modified, mta.is_del, pex.num as export_project_num, pim.num as import_project_num, pex.name
		as export_project_name, pim.name as import_project_name
		from material_transfer_application mta left join project pex on pex.id=mta.export_project_id left join project pim on
		pim.id=mta.import_project_id,(select mta2.id from material_transfer_application mta2 left join project
		pex2 on pex2.id=mta2.export_project_id left join project pim2 on pim2.id=mta2.import_project_id
		where
		mta2.company_id=#{materialTransferApplicationDto.companyId} and mta2.is_del=false
		<if test="materialTransferApplicationDto.id != null">
			and mta2.id like CONCAT('%',#{materialTransferApplicationDto.id},'%')
		</if>
		<if
			test="materialTransferApplicationDto.importProjectName != null and materialTransferApplicationDto.importProjectName != ''">
			and pim2.name like CONCAT('%',#{materialTransferApplicationDto.importProjectName,jdbcType=VARCHAR},'%')
		</if>
		<if test="materialTransferApplicationDto.type != null and materialTransferApplicationDto.type != ''">
			and mta2.type = #{materialTransferApplicationDto.type,jdbcType=VARCHAR}
		</if>
		<if
			test="materialTransferApplicationDto.exportProjectName != null and materialTransferApplicationDto.exportProjectName != ''">
			and pex2.name like CONCAT('%',#{materialTransferApplicationDto.exportProjectName,jdbcType=VARCHAR},'%')
		</if>
		<if test="materialTransferApplicationDto.status != null and materialTransferApplicationDto.status != ''">
			and mta2.status = #{materialTransferApplicationDto.status,jdbcType=VARCHAR}
		</if>
		<if test="materialTransferApplicationDto.staffName != null and materialTransferApplicationDto.staffName != ''">
			and mta2.staff_name like CONCAT('%',#{materialTransferApplicationDto.staffName,jdbcType=VARCHAR},'%')
		</if>
		<if test="materialTransferApplicationDto.cstCreate != null">
			and to_days(mta2.cst_create)=to_days(#{materialTransferApplicationDto.cstCreate,jdbcType=TIMESTAMP})
		</if>
		order by mta2.id asc limit #{page.frontIndex},#{page.size})temp where mta.id=temp.id order by mta.id
	</select>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.warmheart.workerunion.server.dao.ProjectApplicationMapper">
	<resultMap id="BaseResultMap" type="top.warmheart.workerunion.server.model.ProjectApplication">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		<id column="project_id" jdbcType="BIGINT" property="projectId" />
		<id column="staff_id" jdbcType="BIGINT" property="staffId" />
		<result column="type" jdbcType="VARCHAR" property="type" />
	</resultMap>
	<resultMap id="Staff2DtoMap" type="top.warmheart.workerunion.server.dto.Staff2Dto">
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="company_id" jdbcType="BIGINT" property="companyId" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="sex" jdbcType="VARCHAR" property="sex" />
		<result column="job_no" jdbcType="VARCHAR" property="jobNo" />
		<result column="native_place" jdbcType="VARCHAR" property="nativePlace" />
		<result column="phone" jdbcType="VARCHAR" property="phone" />
		<result column="id_card_no" jdbcType="VARCHAR" property="idCardNo" />
		<result column="address" jdbcType="VARCHAR" property="address" />
		<result column="entry_date" jdbcType="DATE" property="entryDate" />
		<result column="career" jdbcType="VARCHAR" property="career" />
		<result column="birthday" jdbcType="DATE" property="birthday" />
		<result column="cst_create" jdbcType="TIMESTAMP" property="cstCreate" />
		<result column="cst_modified" jdbcType="TIMESTAMP" property="cstModified" />
		<result column="memo" jdbcType="VARCHAR" property="memo" />
		<result column="is_del" jdbcType="BIT" property="del" />
		<result column="qualification" jdbcType="VARCHAR" property="qualification" />
		<result column="type" jdbcType="VARCHAR" property="type" />
	</resultMap>
	<delete id="deleteByPrimaryKey" parameterType="map">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		delete from project_application
		where project_id = #{projectId,jdbcType=BIGINT}
		and staff_id =
		#{staffId,jdbcType=BIGINT}
	</delete>
	<insert id="insert" parameterType="top.warmheart.workerunion.server.model.ProjectApplication">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		insert into project_application (project_id, staff_id, type
		)
		values (#{projectId,jdbcType=BIGINT},
		#{staffId,jdbcType=BIGINT}, #{type,jdbcType=VARCHAR}
		)
	</insert>
	<update id="updateByPrimaryKey" parameterType="top.warmheart.workerunion.server.model.ProjectApplication">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		update project_application
		set type = #{type,jdbcType=VARCHAR}
		where project_id = #{projectId,jdbcType=BIGINT}
		and
		staff_id = #{staffId,jdbcType=BIGINT}
	</update>
	<select id="selectByPrimaryKey" parameterType="map" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select project_id, staff_id, type
		from project_application
		where project_id = #{projectId,jdbcType=BIGINT}
		and staff_id =
		#{staffId,jdbcType=BIGINT}
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select project_id, staff_id, type
		from project_application
	</select>
	<select id="selectListStaffByProjectId" resultMap="Staff2DtoMap">
		select s.id, s.company_id, s.name, s.sex, s.job_no,
		s.native_place, s.phone, s.id_card_no, s.address,
		s.entry_date, s.career, s.birthday, s.cst_create, s.cst_modified,
		s.memo, s.is_del, pa.type as type,
		group_concat(distinct c.certificate_type_name) qualification
		from staff s join
		project_application pa on s.id=pa.staff_id left join certificate c on s.id=c.staff_id and c.is_del=false
		where
		project_id=#{projectId,jdbcType=BIGINT} group by s.id
	</select>

	<select id="selectByProjectRole" resultMap="BaseResultMap">
		select project_id, staff_id, type
		from project_application where
		project_id=#{projectId,jdbcType=BIGINT} and type=#{type,jdbcType=VARCHAR}
	</select>

	<select id="selectValidByStaff" resultMap="BaseResultMap">
		select pa.project_id, pa.staff_id, pa.type
		from project_application pa
		join project p on p.id=pa.project_id and p.collapse_status=#{goingCollapseStatus,jdbcType=VARCHAR} where
		staff_id=#{staffId,jdbcType=BIGINT}
	</select>

	<insert id="insertUnique" parameterType="top.warmheart.workerunion.server.model.ProjectApplication">
		insert into project_application (project_id, staff_id, type
		)
		select
		#{projectId,jdbcType=BIGINT}, #{staffId,jdbcType=BIGINT}, #{type,jdbcType=VARCHAR}
		 from dual where not exists(select pa.staff_id
		from project_application pa
		join project p on p.id=pa.project_id and p.collapse_status=#{goingCollapseStatus,jdbcType=VARCHAR} where
		staff_id=#{staffId,jdbcType=BIGINT})
	</insert>
</mapper>
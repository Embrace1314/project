<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.warmheart.workerunion.server.dao.MaterialOrderMapper">
	<resultMap id="BaseResultMap" type="top.warmheart.workerunion.server.model.MaterialOrder">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="company_id" jdbcType="BIGINT" property="companyId" />
		<result column="project_id" jdbcType="BIGINT" property="projectId" />
		<result column="staff_id" jdbcType="BIGINT" property="staffId" />
		<result column="staff_name" jdbcType="VARCHAR" property="staffName" />
		<result column="batch_no" jdbcType="VARCHAR" property="batchNo" />
		<result column="money" jdbcType="DECIMAL" property="money" />
		<result column="type" jdbcType="VARCHAR" property="type" />
		<result column="cst_create" jdbcType="TIMESTAMP" property="cstCreate" />
		<result column="cst_modified" jdbcType="TIMESTAMP" property="cstModified" />
		<result column="is_del" jdbcType="BIT" property="del" />
	</resultMap>
	<delete id="deleteByPrimaryKey" parameterType="java.math.BigInteger">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		delete from material_order
		where id = #{id,jdbcType=BIGINT}
	</delete>
	<insert id="insert" parameterType="top.warmheart.workerunion.server.model.MaterialOrder">
		<selectKey keyProperty="id" order="AFTER" resultType="java.math.BigInteger">
			SELECT LAST_INSERT_ID()
		</selectKey>
		insert into material_order (company_id, project_id, staff_id,
		staff_name, batch_no, money,
		type, cst_create, cst_modified,
		is_del)
		values (#{companyId,jdbcType=BIGINT}, #{projectId,jdbcType=BIGINT}, #{staffId,jdbcType=BIGINT},
		#{staffName,jdbcType=VARCHAR}, #{batchNo,jdbcType=VARCHAR}, #{money,jdbcType=DECIMAL},
		#{type,jdbcType=VARCHAR}, now(), now(),
		false)
	</insert>
	<update id="updateByPrimaryKey" parameterType="top.warmheart.workerunion.server.model.MaterialOrder">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		update material_order
		set company_id = #{companyId,jdbcType=BIGINT},
		project_id = #{projectId,jdbcType=BIGINT},
		staff_id = #{staffId,jdbcType=BIGINT},
		staff_name = #{staffName,jdbcType=VARCHAR},
		batch_no = #{batchNo,jdbcType=VARCHAR},
		money = #{money,jdbcType=DECIMAL},
		type = #{type,jdbcType=VARCHAR},
		cst_create = #{cstCreate,jdbcType=TIMESTAMP},
		cst_modified = #{cstModified,jdbcType=TIMESTAMP},
		is_del = #{del,jdbcType=BIT}
		where id = #{id,jdbcType=BIGINT}
	</update>
	<select id="selectByPrimaryKey" parameterType="java.math.BigInteger" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select id, company_id, project_id, staff_id, staff_name, batch_no, money, type, cst_create,
		cst_modified, is_del
		from material_order
		where id = #{id,jdbcType=BIGINT}
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not modify. -->
		select id, company_id, project_id, staff_id, staff_name, batch_no, money, type, cst_create,
		cst_modified, is_del
		from material_order
	</select>
	<select id="selectByProjectBatchNo" resultMap="BaseResultMap">
		select id, company_id, project_id, staff_id, staff_name, batch_no, money, type, cst_create,
		cst_modified, is_del
		from material_order where project_id=#{projectId, jdbcType=BIGINT} and batch_no=#{batchNo, jdbcType=VARCHAR}
	</select>
	
	<select id="countByFuzzy" resultType="java.lang.Integer">
		select count(distinct id)
		from material_order where project_id=#{projectId,jdbcType=BIGINT} and is_del=false
		<if test="staffName != null and staffName != ''">
			and staff_name like CONCAT('%',#{staffName,jdbcType=VARCHAR},'%')
		</if>
		<if test="cstCreate != null">
			and to_days(cst_create)=to_days(#{cstCreate,jdbcType=TIMESTAMP})
		</if>
		<if test="batchNo != null and batchNo != ''">
			and batch_no like CONCAT('%',#{batchNo,jdbcType=VARCHAR},'%')
		</if>
	</select>
	<select id="pageByFuzzy" resultMap="BaseResultMap">
		select mo.id, mo.company_id, mo.project_id, mo.staff_id, mo.staff_name, mo.batch_no, mo.money, mo.type, mo.cst_create,
		mo.cst_modified, mo.is_del
		from material_order mo,(select distinct id from material_order where project_id=#{projectId,jdbcType=BIGINT} and is_del=false
		<if test="staffName != null and staffName != ''">
			and staff_name like CONCAT('%',#{staffName,jdbcType=VARCHAR},'%')
		</if>
		<if test="cstCreate != null">
			and to_days(cst_create)=to_days(#{cstCreate,jdbcType=TIMESTAMP})
		</if>
		<if test="batchNo != null and batchNo != ''">
			and batch_no like CONCAT('%',#{batchNo,jdbcType=VARCHAR},'%')
		</if>
		order by id desc limit #{page.frontIndex},#{page.size})temp
		where mo.id=temp.id order by mo.id desc
	</select>
</mapper>